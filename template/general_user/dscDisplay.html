{% extends "general_user/base_general_user.html" %}
{% load dsc_extras %} 

{% block title %}DSC Details{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-primary"><i class="bi bi-info-circle-fill me-2"></i>DSC Full Details</h2>
        <a href="{% url 'general_user_search_dsc' %}" class="btn btn-outline-secondary rounded-pill shadow-sm px-4">
            <i class="bi bi-arrow-left me-2"></i>Back
        </a>
    </div>

    {% if dsc_master %}
    
    <!-- Basic Info Card -->
    <div class="card shadow-sm mb-4 border-0 rounded-4">
        <div class="card-header bg-danger text-white rounded-top-4">
            <h5 class="m-0"><i class="bi bi-shield-check me-2"></i> Certificate Overview</h5>
        </div>
        <div class="card-body">
            <div class="row gy-3 gx-4">
                <div class="col-md-4"><strong>DSC Number:</strong> {{ dsc_master.dsc_number }}</div>
                <div class="col-md-4"><strong>DSC Type:</strong> {{ dsc_master.dsc_type }}</div>
                <div class="col-md-4"><strong>Full Name:</strong> {{ dsc_master.full_name }}</div>
                <div class="col-md-4"><strong>Issued:</strong> {{ dsc_master.issued_date }}</div>
                <div class="col-md-4"><strong>License Period:</strong> {{ dsc_master.license_period.no_of_years }} years</div>
                <div class="col-md-4"><strong>Expiry:</strong> {{ dsc_master.expiry_date }}</div>
                <div class="col-md-4">
                    <strong>Status:</strong>
                    <span class="badge rounded-pill px-3 py-2 bg-{{ dsc_master.status|yesno:'success,danger' }} text-white">
                        {{ dsc_master.status }}
                    </span>
                </div>
                <div class="col-md-4"><strong>Password:</strong> {{ dsc_master.password }}</div>
                <div class="col-md-4"><strong>PAN:</strong> {{ dsc_master.pan_no }}</div>
            </div>
        </div>
    </div>

    <!-- DSC Details -->
    <div class="card shadow-sm mb-4 border-0 rounded-4">
        <div class="card-header bg-success text-white rounded-top-4">
            <h5 class="m-0"><i class="bi bi-card-checklist me-2"></i> DSC Information</h5>
        </div>
        <div class="card-body">
            <div class="row gy-3 gx-4">
                <div class="col-md-4"><strong>Class:</strong> {{ dsc_master.dsc_class.class_name }}</div>
                <div class="col-md-4"><strong>Authority:</strong> {{ dsc_master.issuing_auth.auth_name }}</div>
                <div class="col-md-4"><strong>Category:</strong> {{ dsc_master.type }}</div>
                <div class="col-md-4"><strong>Ref. Name:</strong> {{ dsc_master.ref_name }}</div>
                <div class="col-md-4"><strong>Ref. Contact:</strong> {{ dsc_master.ref_contact }}</div>
                <div class="col-md-4"><strong>Email:</strong> {{ dsc_master.email_id }}</div>
                <div class="col-md-4"><strong>Phone:</strong> {{ dsc_master.phone_no }}</div>
                <!-- User Id -->
                <div class="col-md-4"><strong>generated By:</strong> {{ dsc_master.user_id }}</div>
                <div class="col-md-4">
                    <strong>Entities:</strong>
                    {% for entity in entities %}
                        <span class="badge text-bg-info me-1">{{ entity }}</span>
                    {% empty %}
                        <span class="text-muted">None</span>
                    {% endfor %}
                </div>
                <div class="col-md-4"><strong>Type:</strong> {{ dsc_master.type }}</div>
                <div class="col-md-8"><strong>Remarks:</strong> {{ dsc_master.remarks }}</div>
            </div>
        </div>
    </div>

    <!-- Additional Fields -->
    {% if additional_fields %}
    <div class="card shadow-sm mb-4 border-0 rounded-4">
        <div class="card-header bg-dark text-light rounded-top-4">
            <h5 class="m-0"><i class="bi bi-plus-circle me-2"></i> Additional Fields</h5>
        </div>
        <div class="card-body">
            <div class="row gy-3 gx-4">
                {% for field in additional_fields %}
                <div class="col-md-4">
                    <strong>{{ field.name }}:</strong> {{ field.value }}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Documents -->
    <div class="card shadow-sm mb-4 border-0 rounded-4">
        <div class="card-header bg-warning text-white rounded-top-4">
            <h5 class="m-0"><i class="bi bi-folder2-open me-2"></i> Uploaded Documents</h5>
        </div>
        <div class="card-body">
            {% for doc in documents %}
            <div class="row gy-3 gx-4">
                <div class="col-md-4">
                    <strong>Aadhar:</strong>
                    {% if doc.aadhar_path %}
                        <a href="{{ doc.aadhar_path.url }}" class="btn btn-sm btn-outline-light bg-primary text-white"><i class="bi bi-box-arrow-up-right"></i> View</a>
                    {% else %}
                        <span class="text-muted">Not Available</span>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <strong>PAN:</strong>
                    {% if doc.pan_path %}
                        <a href="{{ doc.pan_path.url }}" class="btn btn-sm btn-outline-light bg-primary text-white"><i class="bi bi-box-arrow-up-right"></i> View</a>
                    {% else %}
                        <span class="text-muted">Not Available</span>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <strong>PP Photo:</strong>
                    {% if doc.pp_path %}
                        <a href="{{ doc.pp_path.url }}" class="btn btn-sm btn-outline-light bg-primary text-white"><i class="bi bi-box-arrow-up-right"></i> View</a>
                    {% else %}
                        <span class="text-muted">Not Available</span>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <p class="text-muted">No documents uploaded.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Current Usage -->
    <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header bg-info text-white rounded-top-4">
            <h5 class="m-0"><i class="bi bi-arrow-left-right me-2"></i> Current Usage</h5>
        </div>
        <div class="card-body">
            <p class="mb-0"><strong>Direction:</strong>
                <span class="badge rounded-pill bg-{{ current_direction|yesno:'success,warning' }}">
                    {{ current_direction|default:"N/A"|title }}
                </span>
            </p>
        </div>
    </div>

    {% else %}
    <div class="alert alert-danger mt-4"><i class="bi bi-exclamation-triangle me-2"></i>No DSC data found.</div>
    {% endif %}
</div>
{% endblock %}
